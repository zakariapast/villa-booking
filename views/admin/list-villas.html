<!-- views/admin/list-villas.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All Villas</title>
  <link rel="stylesheet" href="/public/css/admin.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    .villa-card img {
      max-height: 220px;
      object-fit: cover;
      border-radius: 0.375rem;
    }
  </style>
</head>
<body>
  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>All Villas</h2>
      <div>
        <a class="btn btn-outline-secondary me-2" href="/public-home.html" target="_blank">üëÅ View as Customer</a>
        <a class="btn btn-success" href="/admin/villas/add">+ Add Villa</a>
      </div>
    </div>
    <div id="villaList" class="row g-4"></div>
  </div>

  <script>
    async function loadVillas() {
      const res = await fetch('/api/villas');
      const villas = await res.json();
      const list = document.getElementById('villaList');
      list.innerHTML = '';

      villas.forEach(villa => {
        const col = document.createElement('div');
        col.className = 'col-md-6';
        col.innerHTML = `
          <div class="card villa-card">
            <img src="${villa.image}" class="card-img-top" alt="${villa.name}" />
            <div class="card-body">
              <h5 class="card-title">${villa.name}</h5>
              <p class="card-text"><small class="text-muted">${villa.location}</small></p>
              <p class="card-text">${villa.description.substring(0, 120)}...</p>
              <div class="d-flex gap-2 flex-wrap">
                <a href="/admin/rooms/list?villa=${villa.id}" class="btn btn-primary btn-sm">View Rooms</a>
                <a href="/admin/villas/edit?id=${villa.id}" class="btn btn-warning btn-sm">Edit</a>
                <button onclick="deleteVilla('${villa.id}')" class="btn btn-danger btn-sm">Delete</button>
                <button class="btn btn-sm ${villa.visible ? 'btn-outline-success' : 'btn-outline-secondary'}">
                  ${villa.visible ? 'Visible to Public' : 'Hidden from Public'}
                </button>
              </div>
            </div>
          </div>`;
        list.appendChild(col);
      });
    }

async function deleteVilla(id) {
  if (!confirm('Delete this villa?')) return;

  try {
    const res = await fetch(`/api/villas/${id}`, {
      method: 'DELETE'
    });

    if (!res.ok) {
      const msg = await res.text();
      alert(`Failed to delete villa: ${msg}`);
    } else {
      alert('Villa deleted.');
      loadVillas();
    }
  } catch (err) {
    console.error('Delete error:', err);
    alert('Error deleting villa.');
  }
}

  </script>
</body>
</html>
